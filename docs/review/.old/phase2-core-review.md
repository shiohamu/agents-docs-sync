# フェーズ2: コアモジュールのコードレビュー手順書

## レビューの目的
コアモジュールのコード品質、設計パターン、エラーハンドリング、パフォーマンスを評価し、保守性と拡張性を確認します。

## 対象ファイル・ディレクトリ

### メインエントリーポイント
- `docgen/docgen.py` - メインエントリーポイントとDocGenクラス

### Detectors（言語検出モジュール）
- `docgen/detectors/base_detector.py` - 基底クラス
- `docgen/detectors/python_detector.py` - Python検出器
- `docgen/detectors/javascript_detector.py` - JavaScript検出器
- `docgen/detectors/go_detector.py` - Go検出器
- `docgen/detectors/generic_detector.py` - 汎用検出器
- `docgen/detectors/__init__.py` - モジュール初期化

### Parsers（コードパーサー）
- `docgen/generators/parsers/base_parser.py` - 基底クラス
- `docgen/generators/parsers/python_parser.py` - Pythonパーサー
- `docgen/generators/parsers/js_parser.py` - JavaScriptパーサー
- `docgen/generators/parsers/generic_parser.py` - 汎用パーサー
- `docgen/generators/parsers/__init__.py` - モジュール初期化

### Generators（ドキュメント生成器）
- `docgen/generators/agents_generator.py` - AGENTS.md生成器
- `docgen/generators/api_generator.py` - APIドキュメント生成器
- `docgen/generators/readme_generator.py` - README.md生成器
- `docgen/generators/__init__.py` - モジュール初期化

### Collectors（情報収集モジュール）
- `docgen/collectors/project_info_collector.py` - プロジェクト情報収集器
- `docgen/collectors/__init__.py` - モジュール初期化

## レビュー手順

### ステップ1: メインエントリーポイントのレビュー

#### 1.1 docgen.pyの確認
- [ ] `main()`関数の実装が適切か
- [ ] コマンドライン引数の処理が適切か
- [ ] エラーハンドリングが適切か（例外の捕捉、適切な終了コード）
- [ ] ログ出力が適切か
- [ ] 戻り値の処理が適切か（`sys.exit()`の使用）

#### 1.2 DocGenクラスの確認
- [ ] クラスの責務が明確か（単一責任の原則）
- [ ] 初期化処理が適切か（`__init__`メソッド）
- [ ] 設定ファイルの読み込み処理が適切か
- [ ] メソッドの責務が明確か

### ステップ2: Detectorsモジュールのレビュー

#### 2.1 基底クラス（base_detector.py）の確認
- [ ] 抽象基底クラスとして適切に設計されているか
- [ ] 抽象メソッドが適切に定義されているか
- [ ] 共通処理が適切に実装されているか
- [ ] 型ヒントが適切に使用されているか

#### 2.2 各Detectorの実装確認
- [ ] 各Detectorが基底クラスを適切に継承しているか
- [ ] `detect()`メソッドの実装が適切か
- [ ] 検出ロジックが正確か
- [ ] エラーハンドリングが適切か
- [ ] パフォーマンスが考慮されているか（大規模プロジェクトでの`rglob`使用）

#### 2.3 モジュール初期化の確認
- [ ] `__init__.py`で適切にモジュールがエクスポートされているか
- [ ] 循環インポートのリスクがないか

### ステップ3: Parsersモジュールのレビュー

#### 3.1 基底クラス（base_parser.py）の確認
- [ ] 抽象基底クラスとして適切に設計されているか
- [ ] パース処理のインターフェースが適切か
- [ ] エラーハンドリングの共通処理が適切か

#### 3.2 各Parserの実装確認
- [ ] 各Parserが基底クラスを適切に継承しているか
- [ ] パース処理が正確か（構文解析、AST解析など）
- [ ] エッジケースの処理が適切か（空ファイル、不正な構文など）
- [ ] パフォーマンスが考慮されているか（大規模ファイルの処理）

#### 3.3 モジュール初期化の確認
- [ ] `__init__.py`で適切にモジュールがエクスポートされているか

### ステップ4: Generatorsモジュールのレビュー

#### 4.1 AgentsGeneratorの確認
- [ ] AGENTS.mdの生成ロジックが正確か
- [ ] OpenAI仕様に準拠しているか
- [ ] API/ローカルLLM両対応が適切に実装されているか
- [ ] エラーハンドリングが適切か
- [ ] 依存関係のインポートが適切か（`sys.path.insert`の使用が適切か）

#### 4.2 ApiGeneratorの確認
- [ ] APIドキュメントの生成ロジックが正確か
- [ ] パーサーとの連携が適切か
- [ ] テンプレートの使用が適切か

#### 4.3 ReadmeGeneratorの確認
- [ ] README.mdの更新ロジックが正確か
- [ ] 手動セクションの保持が適切に実装されているか
- [ ] マーカーの処理が正確か（`<!-- MANUAL_START:... -->`、`<!-- MANUAL_END:... -->`）

#### 4.4 モジュール初期化の確認
- [ ] `__init__.py`で適切にモジュールがエクスポートされているか

### ステップ5: Collectorsモジュールのレビュー

#### 5.1 ProjectInfoCollectorの確認
- [ ] プロジェクト情報の収集ロジックが正確か
- [ ] `pyproject.toml`の読み込み処理が適切か
- [ ] `tomli`の依存関係が適切に処理されているか（フォールバック処理）
- [ ] エラーハンドリングが適切か

### ステップ6: コード品質の確認

#### 6.1 PEP 8準拠
- [ ] インデントが4スペースか
- [ ] 行の長さが適切か（79文字または100文字以内）
- [ ] 命名規則が適切か（クラス: `PascalCase`、関数/変数: `snake_case`）
- [ ] インポート順序が適切か（標準ライブラリ、サードパーティ、ローカル）

#### 6.2 型ヒント
- [ ] 関数の引数に型ヒントが記載されているか
- [ ] 戻り値の型ヒントが記載されているか
- [ ] `Any`の使用が最小限か（より具体的な型の使用を検討）

#### 6.3 Docstring
- [ ] モジュール、クラス、関数にdocstringが記載されているか
- [ ] docstringの形式が一貫しているか（Google形式、NumPy形式など）
- [ ] パラメータと戻り値の説明が記載されているか

#### 6.4 エラーハンドリング
- [ ] 適切な例外クラスが使用されているか
- [ ] 例外の捕捉が適切か（広すぎる`except:`の回避）
- [ ] エラーメッセージが明確か
- [ ] ログ出力が適切か（適切なログレベル）

### ステップ7: 設計パターンの確認

#### 7.1 設計原則の遵守
- [ ] 単一責任の原則（SRP）が守られているか
- [ ] 開放閉鎖の原則（OCP）が守られているか（基底クラスの使用）
- [ ] 依存性逆転の原則（DIP）が守られているか（抽象への依存）

#### 7.2 モジュール間の依存関係
- [ ] 循環依存がないか
- [ ] モジュール間の結合度が低いか
- [ ] モジュールの凝集度が高いか

### ステップ8: パフォーマンスの確認

#### 8.1 ファイル操作の効率性
- [ ] `rglob`の使用が適切か（大規模プロジェクトでのパフォーマンス）
- [ ] ファイルの読み込みが効率的か（必要最小限の読み込み）
- [ ] キャッシュの活用が検討されているか

#### 8.2 並列処理の可能性
- [ ] 並列処理が可能な箇所があるか（言語検出、パース処理など）
- [ ] 並列処理の実装が適切か（`concurrent.futures`の使用など）

## 確認チェックリスト

### 高優先度
- [ ] エラーハンドリングの適切性
- [ ] メインエントリーポイントの戻り値処理
- [ ] 依存関係のインポート（`sys.path.insert`の使用が適切か）

### 中優先度
- [ ] 型ヒントの完全性
- [ ] Docstringの充実度
- [ ] 設計パターンの一貫性

### 低優先度
- [ ] パフォーマンス最適化の余地
- [ ] コードの重複（DRY原則）

## レビュー結果の記録

### 発見された問題の記録形式
```markdown
#### 問題番号: [問題のタイトル]
- **重要度**: 高/中/低
- **場所**: [ファイルパス:行番号]
- **説明**: [問題の詳細説明]
- **コード例**: [該当コードの抜粋]
- **影響**: [問題が及ぼす影響]
- **推奨対応**: [推奨される修正方法]
```

### 強みの記録形式
```markdown
#### 強み: [強みのタイトル]
- **場所**: [該当箇所]
- **説明**: [なぜ良いのか]
- **コード例**: [該当コードの抜粋]
```

## 次のステップ
レビュー完了後、フェーズ3（テストのレビュー）に進みます。

