# フェーズ3: テストのレビュー手順書

## レビューの目的
テストの品質、カバレッジ、完全性を評価し、テストの信頼性と保守性を確認します。

## 対象ファイル・ディレクトリ

### テスト設定
- `pytest.ini` - テスト設定ファイル
- `tests/conftest.py` - テストフィクスチャの共有設定

### メインテストファイル
- `tests/test_docgen.py` - メインモジュールのテスト
- `tests/test_integration.py` - 統合テスト
- `tests/test_edge_cases.py` - エッジケースのテスト

### Detectorsのテスト
- `tests/test_detectors/test_python_detector.py`
- `tests/test_detectors/test_javascript_detector.py`
- `tests/test_detectors/test_go_detector.py`
- `tests/test_detectors/test_generic_detector.py`
- `tests/test_detectors/__init__.py`

### Parsersのテスト
- `tests/test_parsers/test_python_parser.py`
- `tests/test_parsers/test_js_parser.py`
- `tests/test_parsers/test_generic_parser.py`
- `tests/test_parsers/__init__.py`

### Generatorsのテスト
- `tests/test_generators/test_agents_generator.py`
- `tests/test_generators/test_api_generator.py`
- `tests/test_generators/test_readme_generator.py`
- `tests/test_generators/__init__.py`

## レビュー手順

### ステップ1: テスト設定の確認

#### 1.1 pytest.iniの確認
- [ ] `testpaths`が適切に設定されているか
- [ ] `python_files`, `python_classes`, `python_functions`の命名規則が適切か
- [ ] `addopts`の設定が適切か
  - [ ] カバレッジレポートの設定（`--cov`, `--cov-report`）
  - [ ] 詳細度の設定（`-v`）
  - [ ] トレースバックの設定（`--tb=short`）
- [ ] マーカーが適切に定義されているか（unit, integration, slow）

#### 1.2 conftest.pyの確認
- [ ] 共有フィクスチャが適切に定義されているか
- [ ] フィクスチャのスコープが適切か（function, class, module, session）
- [ ] テストデータの準備が適切か

### ステップ2: テストの完全性の確認

#### 2.1 テストファイルの存在確認
- [ ] 各モジュールに対応するテストファイルが存在するか
- [ ] テストファイルの命名規則が一貫しているか（`test_*.py`）

#### 2.2 テストケースの完全性
- [ ] 各クラス・関数に対してテストケースが存在するか
- [ ] 正常系のテストが存在するか
- [ ] 異常系のテストが存在するか
- [ ] エッジケースのテストが存在するか
- [ ] 未実装のテストがないか（`pass`のみ、コメントのみのテスト）

#### 2.3 テストの実装状況
- [ ] 各テスト関数に実際のテストロジックが実装されているか
- [ ] プレースホルダー（`TODO`, `FIXME`）がないか
- [ ] スキップされているテストに適切な理由があるか（`@pytest.mark.skip`）

### ステップ3: テストの品質の確認

#### 3.1 テストの構造
- [ ] テストが適切に整理されているか（AAAパターン: Arrange, Act, Assert）
- [ ] テストの独立性が保たれているか（他のテストに依存しない）
- [ ] テストの順序に依存していないか

#### 3.2 アサーション
- [ ] 適切なアサーションメソッドが使用されているか（`assert`, `assertEqual`, `assertIn`など）
- [ ] アサーションメッセージが明確か
- [ ] 複数のアサーションが適切に使用されているか

#### 3.3 モックとフィクスチャ
- [ ] モックが適切に使用されているか（`pytest-mock`, `unittest.mock`）
- [ ] 外部依存関係が適切にモックされているか（ファイルシステム、API呼び出しなど）
- [ ] フィクスチャが適切に使用されているか
- [ ] テストデータの準備が適切か

#### 3.4 エッジケースのテスト
- [ ] 空の入力に対するテストがあるか
- [ ] 不正な入力に対するテストがあるか
- [ ] 境界値のテストがあるか
- [ ] エラーケースのテストがあるか

### ステップ4: テストカバレッジの確認

#### 4.1 カバレッジレポートの生成
- [ ] カバレッジレポートが生成されるか確認
  ```bash
  pytest --cov=.docgen --cov-report=html
  ```
- [ ] HTMLレポートが生成されるか確認（`htmlcov/index.html`）

#### 4.2 カバレッジ率の確認
- [ ] 全体のカバレッジ率を確認（目標: 80%以上）
- [ ] 各モジュールのカバレッジ率を確認
- [ ] カバレッジが低いモジュールを特定

#### 4.3 カバレッジの詳細確認
- [ ] 未カバーの行を確認
- [ ] 未カバーの行が適切か（例外処理、デバッグコードなど）
- [ ] 重要なロジックがカバーされているか

### ステップ5: 統合テストの確認

#### 5.1 統合テストの存在確認
- [ ] `test_integration.py`が存在するか
- [ ] 統合テストが適切に実装されているか

#### 5.2 統合テストの内容確認
- [ ] エンドツーエンドのテストがあるか
- [ ] 複数モジュールの連携テストがあるか
- [ ] 実際のファイル操作のテストがあるか

### ステップ6: テストの実行確認

#### 6.1 テストの実行
- [ ] すべてのテストが正常に実行されるか
  ```bash
  pytest
  ```
- [ ] テストの実行時間が適切か

#### 6.2 テストの結果確認
- [ ] すべてのテストがパスするか
- [ ] 失敗しているテストがないか
- [ ] 警告がないか

#### 6.3 マーカーの使用確認
- [ ] マーカーが適切に使用されているか（`@pytest.mark.unit`, `@pytest.mark.integration`など）
- [ ] 特定のマーカーのテストのみ実行できるか
  ```bash
  pytest -m unit
  pytest -m integration
  ```

### ステップ7: テストの保守性の確認

#### 7.1 テストコードの品質
- [ ] テストコードが読みやすいか
- [ ] テストの意図が明確か（テスト名、コメント）
- [ ] テストコードの重複がないか（DRY原則）

#### 7.2 テストデータの管理
- [ ] テストデータが適切に管理されているか
- [ ] テストデータの準備が簡単か
- [ ] テストデータのクリーンアップが適切か

#### 7.3 テストの実行環境
- [ ] テストが異なる環境で実行可能か
- [ ] 外部依存関係が適切にモックされているか
- [ ] テストの実行に特別な設定が必要か

## 確認チェックリスト

### 高優先度
- [ ] すべてのテストが実装されている（未実装のテストがない）
- [ ] テストカバレッジが80%以上
- [ ] すべてのテストがパスする

### 中優先度
- [ ] エッジケースのテストが充実している
- [ ] 統合テストが適切に実装されている
- [ ] モックが適切に使用されている

### 低優先度
- [ ] テストコードの品質（可読性、保守性）
- [ ] テストの実行時間
- [ ] テストデータの管理

## レビュー結果の記録

### 発見された問題の記録形式
```markdown
#### 問題番号: [問題のタイトル]
- **重要度**: 高/中/低
- **場所**: [ファイルパス:行番号]
- **説明**: [問題の詳細説明]
- **テストカバレッジ**: [該当モジュールのカバレッジ率]
- **影響**: [問題が及ぼす影響]
- **推奨対応**: [推奨される修正方法]
```

### 強みの記録形式
```markdown
#### 強み: [強みのタイトル]
- **場所**: [該当箇所]
- **説明**: [なぜ良いのか]
- **カバレッジ率**: [該当モジュールのカバレッジ率]
```

## テストカバレッジレポートの生成方法

### HTMLレポートの生成
```bash
pytest --cov=.docgen --cov-report=html
# ブラウザで htmlcov/index.html を開く
```

### ターミナルレポートの生成
```bash
pytest --cov=.docgen --cov-report=term-missing
```

### XMLレポートの生成（CI/CD用）
```bash
pytest --cov=.docgen --cov-report=xml
```

## 次のステップ
レビュー完了後、フェーズ4（スクリプトとCI/CDのレビュー）に進みます。

